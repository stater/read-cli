{"version":3,"file":"main.js","sources":["../lib/helper.js","../lib/reader.js"],"sourcesContent":["let env = 'default', arg = {};\n\nexport function setCfg(res) {\n  env = res.env;\n  arg = res.arg;\n}\n\nexport function byEnv(object = {}) {\n  return merge(env, object);\n}\n\nexport function byOpt(options = [], object = {}) {\n  let opt;\n\n  for (let name of options) {\n    if (arg.hasOwnProperty(name)) {\n      if (arg[name] === true) {\n        opt = name.replace(/^\\-\\-/, '');\n      } else {\n        opt = arg[name];\n      }\n    }\n\n    if (process.env[name]) {\n      opt = process.env[name];\n    }\n  }\n\n  return merge(opt, object);\n}\n\nfunction merge(opt, object = {}) {\n  let def = object.default || {};\n  let rep = {};\n\n  if (object.hasOwnProperty(opt)) {\n    rep = object[opt];\n  }\n\n  for (let key in rep) {\n    if (rep.hasOwnProperty(key)) {\n      def[key] = rep[key];\n    }\n  }\n\n  return def;\n}\n","import { setCfg } from './helper';\n\nlet color;\n\ntry {\n  // Trying to use cli-color if available on the user's project.\n  color = require('cli-color');\n} catch (err) {\n  // Create fake color if cli-color unavailable.\n  color = {\n    redBright: (text) => text,\n    yellow: (text) => text\n  }\n}\n\nexport function parse({ configs = {}, options = [], protect, remdash = true, nocommand = false } = {}) {\n  const { NODE_ENV } = process.env;\n  const argv = [...process.argv];\n\n  let [engine, input] = argv.splice(0, 2);\n  let [command] = argv;\n  let origin = argv.join(' ');\n\n  let arg = { engine, input };\n\n  if (!nocommand) {\n    arg.command = command;\n  }\n\n  for (let key in configs) {\n    arg[key] = configs[key];\n  }\n\n  let haserror = false;\n\n  for (let input of argv) {\n    let [key, value] = input.split('=');\n\n    if (!(configs.hasOwnProperty(key) || options.includes(key))) {\n      haserror = true;\n      origin = origin.replace(key, color.yellow(`![${color.redBright(key)}]`));\n    }\n\n    if (!value && configs.hasOwnProperty(key)) {\n      value = typeof configs[key] === 'boolean' ? true : (argv.splice(argv.indexOf(input) + 1, 1)[0] || configs[key]);\n    }\n\n    if (!value && options.includes(key)) {\n      value = true;\n    }\n\n    if (value === 'true') {\n      value = true;\n    } else if (value === 'false') {\n      value = false;\n    } else if (typeof value === 'string' && Number(value)) {\n      value = Number(value);\n    }\n\n    arg[key] = value || true;\n  }\n\n  if (haserror) {\n    const error = new Error(`${color.redBright('Unknown argument(s):')} ${origin}${color.redBright('.')}`);\n\n    if (protect) {\n      arg.error = error;\n\n      if (protect === 'throw') {\n        throw arg.error;\n      }\n    }\n  }\n\n  for (let key in arg) {\n    if (/^\\-/.test(key)) {\n      let rem = key.replace(/^\\-\\-/, '').replace(/^\\-/, '');\n      arg[rem] = arg[key];\n\n      if (remdash === true) {\n        delete arg[key];\n      }\n    }\n  }\n\n  let env = 'development';\n\n  if (argv.includes('--staging')) {\n    env = 'staging';\n  }\n\n  if (argv.includes('--production')) {\n    env = 'production';\n  }\n\n  if (NODE_ENV) {\n    env = NODE_ENV;\n  }\n\n  setCfg({ env, arg });\n\n  return { env, arg };\n}\n"],"names":[],"mappings":"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"}